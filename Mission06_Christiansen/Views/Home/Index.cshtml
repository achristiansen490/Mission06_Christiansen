@model List<Mission06_Christiansen.Models.Movie>
@*
    Index.cshtml
    - Displays the full movie collection
    - Includes search + filter functionality (GET so query shows in URL)
    - Shows Edit/Delete buttons for each movie (Mission 7 requirement)
*@

@{
    ViewData["Title"] = "Movie Collection";

    // Retrieve filter values from ViewBag so the form remembers selections
    var search = (string)(ViewBag.Search ?? "");
    var rating = (string)(ViewBag.Rating ?? "");
    var edited = (string)(ViewBag.Edited ?? "");
}

<!-- =========================
     PAGE HEADER
========================= -->
<div class="text-center">
    <h1 class="display-4">Joel Hilton Movie Collection</h1>

    <!-- Centered headshot image -->
    <div class="mt-3 mb-4">
        <img src="~/images/JoelHiltonHeadshot.jpg"
             alt="Joel Hilton Headshot"
             class="img-fluid hero-headshot" />
    </div>

    <p class="text-muted">
        Browse, search, and filter the movie collection.
    </p>
</div>

<!-- =========================
     SEARCH + FILTER FORM
     Uses GET so parameters appear in the URL
========================= -->
<form method="get" class="mt-4 mb-4">
    <div class="row g-2 align-items-end">

        <!-- Search box -->
        <div class="col-12 col-md-6">
            <label class="form-label">Search</label>
            <input name="search"
                   value="@search"
                   class="form-control"
                   placeholder="Search title, category, or director..." />
        </div>

        <!-- Rating filter -->
        <div class="col-6 col-md-3">
            <label class="form-label">Rating</label>
            <select name="rating" class="form-select">
                <option value="" selected="@(rating == "")">All</option>
                <option value="G" selected="@(rating == "G")">G</option>
                <option value="PG" selected="@(rating == "PG")">PG</option>
                <option value="PG-13" selected="@(rating == "PG-13")">PG-13</option>
                <option value="R" selected="@(rating == "R")">R</option>
            </select>
        </div>

        <!-- Edited filter -->
        <div class="col-6 col-md-3">
            <label class="form-label">Edited</label>
            <select name="edited" class="form-select">
                <option value="" selected="@(edited == "")">All</option>
                <option value="true" selected="@(edited == "true")">Yes</option>
                <option value="false" selected="@(edited == "false")">No</option>
            </select>
        </div>

        <!-- Buttons row -->
        <div class="col-12 d-flex gap-2 mt-2">

            <!-- Apply filters -->
            <button type="submit" class="btn btn-primary">
                Apply Filters
            </button>

            <!-- Reset filters (go back to /Home/Index with no query params) -->
            <a class="btn btn-secondary"
               asp-controller="Home"
               asp-action="Index">
                Reset
            </a>

            <!-- Add Movie button aligned right -->
            <a class="btn btn-outline-primary ms-auto"
               asp-controller="Home"
               asp-action="AddMovie">
                Add a New Movie
            </a>
        </div>
    </div>
</form>

<!-- =========================
     RESULTS SECTION
========================= -->

@* If the model is null or empty, display a friendly message *@
@if (Model == null || Model.Count == 0)
{
    <p>No movies found for your search/filter.</p>
}
else
{
    <!-- Show number of results -->
    <p class="text-muted">
        Showing <strong>@Model.Count</strong> movie(s).
    </p>

    <!-- Movie Table -->
    <table class="table table-striped table-bordered align-middle">
        <thead class="table-dark">
        <tr>
            <th>Title</th>
            <th>Category</th>
            <th>Year</th>
            <th>Director</th>
            <th>Rating</th>
            <th>Edited</th>
            <th>Lent To</th>
            <th>Notes</th>
            <th class="text-center">Actions</th>
        </tr>
        </thead>

        <tbody>
        @* Loop through each movie and display its properties *@
        @foreach (var m in Model)
        {
            <tr>
                <td>@m.Title</td>

                @* Category is a navigation property; display CategoryName safely *@
                <td>@(m.Category?.CategoryName ?? "")</td>

                <td>@m.Year</td>
                <td>@m.Director</td>
                <td>@m.Rating</td>

                @* Edited is a non-nullable bool in Mission 7 *@
                <td>@(m.Edited ? "Yes" : "No")</td>

                <td>@m.LentTo</td>
                <td>@m.Notes</td>

                <!-- ACTION BUTTONS (Edit/Delete) -->
                <td class="text-center text-nowrap">
                    @* Edit button takes user to /Home/Edit/{id} *@
                    <a class="btn btn-sm btn-outline-primary"
                       asp-controller="Home"
                       asp-action="Edit"
                       asp-route-id="@m.MovieId">
                        Edit
                    </a>

                    @* Delete button goes to confirmation screen /Home/Delete/{id} *@
                    <a class="btn btn-sm btn-outline-danger ms-2"
                       asp-controller="Home"
                       asp-action="Delete"
                       asp-route-id="@m.MovieId">
                        Delete
                    </a>
                </td>
            </tr>
        }
        </tbody>
    </table>
}